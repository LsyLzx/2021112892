


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=GBK"> 
  <title>Coverage Report > GraphPanel</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">&lt;empty package name&gt;</a>
</div>

<h1>Coverage Summary for Class: GraphPanel (&lt;empty package name&gt;)</h1>

<table class="coverageStats">
<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Class, %
</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">GraphPanel</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/10)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/34)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/123)
  </span>
</td>
</tr>

</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;import java.awt.BasicStroke;
&nbsp;import java.awt.Color;
&nbsp;import java.awt.FontMetrics;
&nbsp;import java.awt.Graphics;
&nbsp;import java.awt.Graphics2D;
&nbsp;import java.awt.Point;
&nbsp;import java.awt.RenderingHints;
&nbsp;import java.awt.geom.QuadCurve2D;
&nbsp;import java.awt.image.BufferedImage;
&nbsp;import java.io.File;
&nbsp;import java.io.IOException;
&nbsp;import java.util.ArrayList;
&nbsp;import java.util.HashMap;
&nbsp;import java.util.HashSet;
&nbsp;import java.util.List;
&nbsp;import java.util.Map;
&nbsp;import java.util.Set;
&nbsp;import javax.imageio.ImageIO;
&nbsp;import javax.swing.JPanel;
&nbsp;
&nbsp;final class GraphPanel extends JPanel {
&nbsp;  private Map&lt;String, Map&lt;String, Integer&gt;&gt; graph; // 存储图的结构，节点及其邻接节点和边的权重
&nbsp;  private Map&lt;String, Point&gt; positions; // 存储每个节点在面板上的位置
&nbsp;  private String firstWord; // 图中第一个单词
&nbsp;  private List&lt;String&gt; highlightedPath; // 要高亮显示的路径
&nbsp;
&nbsp;  // 色系，用于节点的颜色
<b class="nc">&nbsp;  private final Color[] colors = {</b>
&nbsp;    new Color(0x74AED4),
&nbsp;    new Color(0xECA8A9),
&nbsp;    new Color(0xD3E2B7),
&nbsp;    new Color(0xCFAFD4),
&nbsp;    new Color(0xF7C97E),
&nbsp;    new Color(0xeca680),
&nbsp;    new Color(0x71DBC8),
&nbsp;    new Color(0xfb63a9),
&nbsp;    new Color(0x8ccbea),
&nbsp;    new Color(0x76925c),
&nbsp;  };
&nbsp;
<b class="nc">&nbsp;  public GraphPanel() {</b>
<b class="nc">&nbsp;    graph = new HashMap&lt;&gt;();</b>
<b class="nc">&nbsp;    positions = new HashMap&lt;&gt;();</b>
<b class="nc">&nbsp;    highlightedPath = new ArrayList&lt;&gt;();</b>
&nbsp;  }
&nbsp;
&nbsp;  public void setGraph(Map&lt;String, Map&lt;String, Integer&gt;&gt; graph, String firstWord) {
<b class="nc">&nbsp;    this.graph = graph;</b>
<b class="nc">&nbsp;    this.firstWord = firstWord;</b>
<b class="nc">&nbsp;    generatePositions();</b>
&nbsp;  }
&nbsp;
&nbsp;  public void setHighlightedPath(List&lt;String&gt; path) {
<b class="nc">&nbsp;    highlightedPath = path;</b>
&nbsp;  }
&nbsp;
&nbsp;
&nbsp;  public void clearHighlightedPath() {
<b class="nc">&nbsp;    highlightedPath = new ArrayList&lt;&gt;();</b>
&nbsp;  }
&nbsp;
&nbsp;  public void clearGraph() {
<b class="nc">&nbsp;    graph = new HashMap&lt;&gt;();</b>
<b class="nc">&nbsp;    positions = new HashMap&lt;&gt;();</b>
<b class="nc">&nbsp;    highlightedPath = new ArrayList&lt;&gt;();</b>
<b class="nc">&nbsp;    firstWord = null;</b>
<b class="nc">&nbsp;    repaint();</b>
&nbsp;  }
&nbsp;
&nbsp;  private void generatePositions() {
<b class="nc">&nbsp;    int width = 1000; // 面板宽度</b>
<b class="nc">&nbsp;    int height = 1400; // 面板高度</b>
<b class="nc">&nbsp;    int margin = 10; // 边距</b>
<b class="nc">&nbsp;    int levelHeight = (height - 2 * margin) / (graph.size() + 1); // 计算每层的高度</b>
&nbsp;
<b class="nc">&nbsp;    Map&lt;String, Integer&gt; levels = new HashMap&lt;&gt;(); // 存储每个节点的层次</b>
<b class="nc">&nbsp;    Set&lt;String&gt; visited = new HashSet&lt;&gt;(); // 存储已访问的节点</b>
<b class="nc">&nbsp;    int maxLevel = 0; // 记录最大层次</b>
&nbsp;
<b class="nc">&nbsp;    if (firstWord != null &amp;&amp; graph.containsKey(firstWord)) {</b>
<b class="nc">&nbsp;      maxLevel = assignLevels(firstWord, 0, levels, visited); // 分配层次</b>
&nbsp;    }
&nbsp;
<b class="nc">&nbsp;    Map&lt;Integer, List&lt;String&gt;&gt; levelNodes = new HashMap&lt;&gt;(); // 存储每层的节点</b>
<b class="nc">&nbsp;    for (Map.Entry&lt;String, Integer&gt; entry : levels.entrySet()) {</b>
<b class="nc">&nbsp;      String node = entry.getKey();</b>
<b class="nc">&nbsp;      int level = entry.getValue();</b>
&nbsp;
<b class="nc">&nbsp;      levelNodes.putIfAbsent(level, new ArrayList&lt;&gt;());</b>
<b class="nc">&nbsp;      levelNodes.get(level).add(node);</b>
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;    // 根据层次和节点数量计算节点位置
<b class="nc">&nbsp;    for (int level = 0; level &lt;= maxLevel; level++) {</b>
<b class="nc">&nbsp;      List&lt;String&gt; nodes = levelNodes.get(level);</b>
<b class="nc">&nbsp;      if (nodes != null) {</b>
<b class="nc">&nbsp;        int levelWidth = (width - 2 * margin) / (nodes.size() + 1);</b>
<b class="nc">&nbsp;        for (int i = 0; i &lt; nodes.size(); i++) {</b>
<b class="nc">&nbsp;          String node = nodes.get(i);</b>
<b class="nc">&nbsp;          int x = margin + (i + 1) * levelWidth;</b>
<b class="nc">&nbsp;          int y = margin + level * levelHeight;</b>
<b class="nc">&nbsp;          positions.put(node, new Point(x, y));</b>
&nbsp;        }
&nbsp;      }
&nbsp;    }
&nbsp;  }
&nbsp;
&nbsp;  private int assignLevels(
&nbsp;          String node, int level, Map&lt;String, Integer&gt; levels, Set&lt;String&gt; visited) {
<b class="nc">&nbsp;    visited.add(node);</b>
<b class="nc">&nbsp;    levels.put(node, level);</b>
<b class="nc">&nbsp;    int maxLevel = level;</b>
&nbsp;
<b class="nc">&nbsp;    if (graph.containsKey(node)) {</b>
<b class="nc">&nbsp;      for (String neighbor : graph.get(node).keySet()) {</b>
<b class="nc">&nbsp;        if (!visited.contains(neighbor)) {</b>
<b class="nc">&nbsp;          maxLevel = Math.max(maxLevel, assignLevels(neighbor, level + 1, levels, visited));</b>
&nbsp;        }
&nbsp;      }
&nbsp;    }
<b class="nc">&nbsp;    return maxLevel;</b>
&nbsp;  }
&nbsp;
&nbsp;  protected void paintComponent(Graphics g) {
<b class="nc">&nbsp;    super.paintComponent(g);</b>
<b class="nc">&nbsp;    Graphics2D g2d = (Graphics2D) g;</b>
<b class="nc">&nbsp;    g2d.setRenderingHint(RenderingHints.KEY_ANTIALIASING, RenderingHints.VALUE_ANTIALIAS_ON);</b>
&nbsp;
<b class="nc">&nbsp;    int sum = 0;</b>
&nbsp;    // 绘制边
<b class="nc">&nbsp;    for (Map.Entry&lt;String, Map&lt;String, Integer&gt;&gt; entry : graph.entrySet()) {</b>
<b class="nc">&nbsp;      String from = entry.getKey();</b>
<b class="nc">&nbsp;      Point p1 = positions.get(from);</b>
<b class="nc">&nbsp;      sum++;</b>
<b class="nc">&nbsp;      for (Map.Entry&lt;String, Integer&gt; edge : entry.getValue().entrySet()) {</b>
<b class="nc">&nbsp;        String to = edge.getKey();</b>
&nbsp;        int weight;
<b class="nc">&nbsp;        weight = edge.getValue();</b>
<b class="nc">&nbsp;        Point p2 = positions.get(to);</b>
&nbsp;
<b class="nc">&nbsp;        if (p2 == null) {</b>
&nbsp;          continue;
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        boolean isHighlighted = false;</b>
<b class="nc">&nbsp;        for (int i = 0; i &lt; highlightedPath.size() - 1; i++) {</b>
<b class="nc">&nbsp;          if (highlightedPath.get(i).equals(from) &amp;&amp; highlightedPath.get(i + 1).equals(to)) {</b>
<b class="nc">&nbsp;            isHighlighted = true;</b>
&nbsp;            break;
&nbsp;          }
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        if (isHighlighted) {</b>
<b class="nc">&nbsp;          g2d.setColor(Color.RED); // 突出显示的路径使用红色</b>
<b class="nc">&nbsp;          g2d.setStroke(new BasicStroke(4)); // 较粗的线条</b>
&nbsp;        } else {
<b class="nc">&nbsp;          g2d.setColor(colors[sum % colors.length]); // 其他路径使用灰色</b>
<b class="nc">&nbsp;          g2d.setStroke(new BasicStroke(2)); // 较细的线条</b>
&nbsp;        }
<b class="nc">&nbsp;        drawCurvedArrowLine(g2d, p1.x, p1.y, p2.x, p2.y, isHighlighted); // 画箭头线</b>
<b class="nc">&nbsp;        g2d.setColor(colors[sum % colors.length]);</b>
<b class="nc">&nbsp;        g2d.drawString(String.valueOf(weight), (p1.x + p2.x) / 2, (p1.y + p2.y) / 2);</b>
&nbsp;      }
&nbsp;    }
&nbsp;
&nbsp;    // 绘制节点
<b class="nc">&nbsp;    sum = 0;</b>
<b class="nc">&nbsp;    for (Map.Entry&lt;String, Point&gt; entry : positions.entrySet()) {</b>
<b class="nc">&nbsp;      String node = entry.getKey();</b>
<b class="nc">&nbsp;      Point p = entry.getValue();</b>
<b class="nc">&nbsp;      int adjSize = graph.getOrDefault(node, new HashMap&lt;&gt;()).size();</b>
<b class="nc">&nbsp;      sum++;</b>
<b class="nc">&nbsp;      Color nodeColor = colors[sum % colors.length];</b>
<b class="nc">&nbsp;      g2d.setColor(nodeColor);</b>
&nbsp;
&nbsp;      // 计算椭圆大小
<b class="nc">&nbsp;      FontMetrics fm = g2d.getFontMetrics();</b>
<b class="nc">&nbsp;      int stringWidth = fm.stringWidth(node);</b>
<b class="nc">&nbsp;      int stringHeight = fm.getAscent();</b>
<b class="nc">&nbsp;      int ellipseWidth = stringWidth + 10;</b>
<b class="nc">&nbsp;      int ellipseHeight = stringHeight + 5;</b>
&nbsp;
&nbsp;      // 绘制椭圆
<b class="nc">&nbsp;      g2d.fillOval(p.x - ellipseWidth / 2, p.y - ellipseHeight / 2, ellipseWidth, ellipseHeight);</b>
<b class="nc">&nbsp;      g2d.setColor(nodeColor);</b>
<b class="nc">&nbsp;      g2d.drawOval(p.x - ellipseWidth / 2, p.y - ellipseHeight / 2, ellipseWidth, ellipseHeight);</b>
&nbsp;
&nbsp;      // 绘制节点文本
<b class="nc">&nbsp;      g2d.setColor(Color.BLACK);</b>
<b class="nc">&nbsp;      g2d.drawString(node, p.x - stringWidth / 2, p.y + stringHeight / 4);</b>
&nbsp;    }
&nbsp;  }
&nbsp;
&nbsp;  private void drawCurvedArrowLine(
&nbsp;          Graphics2D g2d, int x1, int y1, int x2, int y2, boolean isHighlighted) {
<b class="nc">&nbsp;    int d = 8; // 箭头的长度</b>
<b class="nc">&nbsp;    int h = 6;  // 箭头的宽度</b>
<b class="nc">&nbsp;    int dx = x2 - x1;</b>
<b class="nc">&nbsp;    int dy = y2 - y1;</b>
&nbsp;
<b class="nc">&nbsp;    double sin = dy / (Math.sqrt(dx * dx + dy * dy));</b>
<b class="nc">&nbsp;    double cos = dx / (Math.sqrt(dx * dx + dy * dy));</b>
&nbsp;
&nbsp;    // 计算缩短后的线条终点
<b class="nc">&nbsp;    int shorteningDistance = 5; // 调整此值以进一步缩短终点</b>
<b class="nc">&nbsp;    int newX2 = x1 + (int) (((Math.sqrt(dx * dx + dy * dy)) - shorteningDistance) * cos);</b>
<b class="nc">&nbsp;    int newY2 = y1 + (int) (((Math.sqrt(dx * dx + dy * dy)) - shorteningDistance) * sin);</b>
&nbsp;
&nbsp;    // 计算曲线的控制点
<b class="nc">&nbsp;    int ctrlX = (x1 + x2) / 2 + dy / 4;</b>
<b class="nc">&nbsp;    int ctrlY = (y1 + y2) / 2 - dx / 4;</b>
&nbsp;
&nbsp;    // 计算终点的切线方向
<b class="nc">&nbsp;    double t = 1; // 在曲线上的位置，取值范围在0到1之间</b>
<b class="nc">&nbsp;    double ctrlDx = 2 * (1 - t) * (ctrlX - x1) + 2 * t * (x2 - ctrlX);</b>
<b class="nc">&nbsp;    double ctrlDy = 2 * (1 - t) * (ctrlY - y1) + 2 * t * (y2 - ctrlY);</b>
<b class="nc">&nbsp;    double ctrlD = Math.sqrt(ctrlDx * ctrlDx + ctrlDy * ctrlDy);</b>
<b class="nc">&nbsp;    double ctrlSin = ctrlDy / ctrlD;</b>
<b class="nc">&nbsp;    double ctrlCos = ctrlDx / ctrlD;</b>
&nbsp;
&nbsp;    // 基于新的终点和切线方向计算箭头的点
<b class="nc">&nbsp;    double xm = newX2 - d * ctrlCos + h * ctrlSin;</b>
<b class="nc">&nbsp;    double ym = newY2 - d * ctrlSin - h * ctrlCos;</b>
<b class="nc">&nbsp;    double xn = newX2 - d * ctrlCos - h * ctrlSin;</b>
<b class="nc">&nbsp;    double yn = newY2 - d * ctrlSin + h * ctrlCos;</b>
&nbsp;
<b class="nc">&nbsp;    int[] xpoints = {newX2, (int) xm, (int) xn};</b>
<b class="nc">&nbsp;    int[] ypoints = {newY2, (int) ym, (int) yn};</b>
&nbsp;
&nbsp;    // 画缩短的曲线
<b class="nc">&nbsp;    QuadCurve2D.Double curve = new QuadCurve2D.Double(x1, y1, ctrlX, ctrlY, newX2, newY2);</b>
<b class="nc">&nbsp;    g2d.draw(curve);</b>
&nbsp;
&nbsp;    // 画实心箭头
<b class="nc">&nbsp;    g2d.fillPolygon(xpoints, ypoints, 3);</b>
&nbsp;  }
&nbsp;
&nbsp;  public void saveGraphAsImage(File file) throws IOException {
<b class="nc">&nbsp;    int width = this.getWidth();</b>
<b class="nc">&nbsp;    int height = this.getHeight();</b>
<b class="nc">&nbsp;    BufferedImage image = new BufferedImage(width, height, BufferedImage.TYPE_INT_ARGB);</b>
<b class="nc">&nbsp;    Graphics2D g2d = image.createGraphics();</b>
<b class="nc">&nbsp;    this.paint(g2d);</b>
<b class="nc">&nbsp;    g2d.dispose();</b>
<b class="nc">&nbsp;    ImageIO.write(image, &quot;PNG&quot;, file);</b>
&nbsp;  }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2024-06-13 19:34</div>
</div>
</body>
</html>
